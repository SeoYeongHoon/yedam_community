<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.yedam.app.yedam_homework.mapper.HomeWorkReplyMapper">

	<!-- 댓글등록 -->
	<insert id="insertReply" parameterType="HomeWorkVO">
		INSERT INTO replies
		(reply_id,
		reply_content,
		homework_target_id)
		VALUES
		(reply_id_seq.nextval,
		#{replyContent},
		#{homeworkTargetId}
		)
	</insert>

	<!-- 댓글 조회 -->
	<select id="selectReplyAll" resultType="HomeWorkVO">
		<!-- SELECT r.homework_target_id, r.reply_content, r.reply_date, r.update_date, 
			r.reply_writer, r.reply_id FROM homeworks h LEFT JOIN homework_targets t 
			ON (h.homework_id = t.homework_id) LEFT JOIN replies r ON (t.homework_target_id 
			= r.homework_target_id) LEFT JOIN comments c ON (r.reply_id = c.comment_id) 
			WHERE h.homework_id = #{homeworkId} -->

		SELECT r.homework_target_id,
		r.reply_content,
		r.reply_date,
		r.reply_writer,
		r.reply_id,
		c.comment_content
		FROM homework_targets t
		JOIN replies r ON (t.homework_target_id = r.homework_target_id)
		JOIN comments c ON (r.reply_id = c.reply_id)
		<where>
			<if test="homeworkId != null and !homeworkId.equals('')">
				AND t.homework_id = #{homeworkId}
			</if>
			<if test="replyId != null and !replyId.equals('')">
				AND r.reply_id = #{replyId}
			</if>
		</where>
	</select>

	<!-- 대댓글 조회 -->
	<select id="selectComment" resultType="HomeWorkVO">
		SELECT
		c.comment_id,
		c.comment_content,
		c.comment_date,
		r.reply_id,
		r.reply_content,
		r.reply_date
		FROM homework_targets t JOIN replies r ON
		(t.homework_target_id =
		r.homework_target_id)
		JOIN comments c ON (
		r.reply_id = c.reply_id)
		WHERE r.reply_id = #{replyId}
	</select>

	<!-- 대댓글 등록 -->
	<insert id="insertComment" parameterType="HomeWorkVO">
		INSERT INTO comments
		(comment_id,
		reply_id,
		comment_content)
		VALUES
		(comment_id_seq.nextval,
		#{replyId},
		#{commentContent}
		)
	</insert>
</mapper>